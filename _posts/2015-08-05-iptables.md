---
layout: post
title: iptalbesのごく基本的な使い方
---

**iptablesは**ファイアーウォールの一実装であり、不要な通信経路を遮断し
必要な通信のみを許可するというセキュリティ機能を提供する。

RHEL7以降は標準ではなくなってしまったが、**まだ**広く使われている。

実行をミスすると操作をしている接続元まで遮断してしまい何もできなくなるので注意。
もしそうなった時は慌てずにサーバをリブートしよう。設定保存前なら接続できる。

## 設定確認

```  
$ sudo iptables -L --line-numbers
```

## 許可するIPの追加
iptablesはhosts.allowなどと同様に上から順番に解釈される。よって接続許可は先頭に、接続拒否は末尾に追加する。

```
$ sudo iptables -I INPUT <行番号> -p tcp -s <サーバ名> --dport <ポート番号> -j ACCEPT
```

## 設定の保存
**ルールが想定通りであることを確認できたら**サーバ起動時に読み込まれる設定ファイルを更新する。
以降はサーバを再起動しても同じルールが設定されるようになる。

```
$ sudo service iptables save # /etc/sysconfig/iptables に設定が保存される
```

## 設定の読み込み
ファイルからルールを読み込むこともできる。サーバの引っ越し時などに使うこともあるかもしれない。

```
$ sudo sh -c 'iptables-restore < /etc/sysconfig/iptables'
```
